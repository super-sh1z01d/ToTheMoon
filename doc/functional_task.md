Функциональное задание: Система 
скоринга токенов "ToTheMoon" 

Версия: 1.1
Дата: 16 сентября 2025 г. 
Цель документа: Описать бизнес-логику, полный жизненный цикл данных, механику 
расчёта скоринга и основные требования к интерфейсу системы для передачи в 
разработку. 
1. Общее описание и цели 

1.1. Назначение системы: 
Система "ToTheMoon" предназначена для автоматического обнаружения, анализа и 
ранжирования токенов на блокчейне Solana с высоким потенциалом для реализации 
арбитражных возможностей. 
1.2. Бизнес-цель: 
Основная цель — сократить операционные расходы (затраты на комиссии сети) 
арбитражного бота за счет фокусировки его работы на наиболее перспективных 
токенах. Система должна предоставлять боту отфильтрованный и отсортированный 
список токенов и их пулов для включения в конфигурационный файл. 
1.3. Архитектурные требования: 

● Модульность скоринга: Архитектура системы должна быть спроектирована таким 
образом, чтобы позволять легкое добавление новых моделей (алгоритмов) расчета 
скора без необходимости переписывать основную логику жизненного цикла 
токенов. Каждая модель скоринга должна быть реализована как отдельный, 
взаимозаменяемый модуль. 

2. Источники данных и ключевые сущности 

2.1. Источники данных: 
● Новые токены: WebSocket wss://pumpportal.fun/data-api/real-time (сообщение 

subscribeMigration). Является триггером для создания новой записи о токене. 
● Агрегированные рыночные данные: Birdeye API. Используется для получения 

агрегированных (общих по токену) данных: ликвидность, объемы торгов, 
количество холдеров. Является основным источником для расчета скоринга. 
● Детализация по пулам: DexScreener API и Jupiter API. Используются совместно для 

получения списка пулов токена, их валидации (проверки, что пул находится на 
реальной DEX) и анализа здоровья каждого пула в отдельности. 

2.2. Ключевые сущности: 
● Токен (Token): Основная сущность системы, представляющая собой 

криптографический токен в сети Solana. 
● Пул ликвидности (Liquidity Pool): Сущность, связанная с Токеном, 

представляющая собой торговую пару на одной из DEX (Raydium, Orca и т.д.). 
2.3. Статусы токена: 
Каждый токен в системе может находиться в одном из трех статусов, определяющих его 

жизненный цикл: 
● Начальный (Initial): Токен только что добавлен в систему и проходит первичный 

мониторинг. 
● Активный (Active): Токен соответствует минимальным критериям активности и 

подвергается постоянному скорингу. Данные по этим токенам являются основным 
результатом работы системы. 

● Архивный (Archived): Токен не проявил достаточной активности за отведенное 
время и исключен из дальнейшего мониторинга. 

3. Жизненный цикл токена 

3.1. Создание (Initial ->): 
● Триггер: Получение сообщения о миграции токена из WebSocket pumpportal.fun. 
● Действие: Система создает в базе данных новую запись о токене с адресом 

контракта из сообщения. Токену присваивается статус Начальный. 
3.2. Переход в статус "Активный" (Initial -> Active): 

● Триггер: Периодическая проверка всех токенов в статусе Начальный. 
● Условие: У токена должен появиться хотя бы один пул ликвидности на 

поддерживаемой DEX, который одновременно удовлетворяет двум критериям: 
1. Общая ликвидность в пуле: ≥ $500. 
2. Количество транзакций (покупки + продажи) за последний час: ≥ min_tx_count 
(настраиваемый параметр, по умолчанию 300). 

● Действие: Статус токена изменяется на Активный. Фиксируется время активации. 
3.3. Переход в статус "Архивный" (Initial -> Archived): 

● Триггер: Периодическая проверка всех токенов в статусе Начальный. 
● Условие: Токен находится в статусе Начальный более 24 часов и не выполнил 

условия для перехода в статус Активный. 
● Действие: Статус токена изменяется на Архивный. Токен исключается из всех 

дальнейших проверок. 
3.4. Возврат в статус "Начальный" (Active -> Initial): 
Токен теряет статус Активный и возвращается на первичный мониторинг при 
выполнении любого из следующих условий: 

● Условие А (Низкий скор): 
○ Триггер: Периодический расчет скоринга для активных токенов. 
○ Логика: Если значение скора токена (рассчитанное по текущей активной 

модели) остается ниже минимального_скора (настраиваемый параметр) на 
протяжении 6 часов подряд. 

○ Действие: Статус токена изменяется на Начальный. 
● Условие Б (Низкая активность в пулах): 

○ Триггер: Периодическая проверка активных токенов. 
○ Логика: Если в ходе проверки выясняется, что хотя бы у одного из валидных 

пулов токена количество транзакций за последний час меньше 
min_tx_count, запускается счетчик `low_activity_streak`. Если такая 
ситуация повторяется N (`LOW_ACTIVITY_STREAK_LIMIT`) проверок подряд, 
статус токена меняется на Начальный. Если все пулы восстанавливают 
активность, счетчик сбрасывается. 

○ Действие: Статус токена изменяется на Начальный. 

4. Расчет скоринга 

4.1. Цель скоринга: 
Предоставить стабильную, количественную оценку краткосрочного арбитражного 
потенциала токена, учитывающую рыночную активность и прямые сигналы о 
неэффективности цен. 
4.2. Модель 1: Гибридный Импульс 

● Итоговая формула:Score = (W_tx * Tx_Accel) + (W_vol * Vol_Momentum) + (W_hld * 
Holder_Growth) + (W_oi * Orderflow_Imbalance) 

● Важно: Все входные компоненты (Tx_Accel, Vol_Momentum и т.д.) и финальный 
Score должны проходить через сглаживание EWMA (Экспоненциальное 
скользящее среднее) для уменьшения волатильности и "дрожания" показателя. 

● Компоненты и их расчет: 
○ Tx_Accel — Ускорение транзакций: 

■ Цель: Оценить, ускоряется ли темп торгов в последние 5 минут по 
сравнению со средним темпом за час. 

■ Формула: (tx_count_5m / 5) / (tx_count_1h / 60) 
○ Vol_Momentum — Импульс объема: 

■ Цель: Сравнить торговый объем за последние 5 минут со средним 
5-минутным объемом за последний час. 

■ Формула: volume_5m / (volume_1h / 12) 
○ Holder_Growth — Рост холдеров (стабилизированный): 

■ Цель: Оценить приток новых держателей токена, что является 
индикатором растущего интереса. 

■ Формула: log(1 + (holders_now - holders_1h_ago) / holders_1h_ago). 
Логарифм используется для стабилизации показателя. 

○ Orderflow_Imbalance — Дисбаланс потока ордеров: 
■ Цель: Оценить преобладающее давление (покупателей или продавцов) 

за последние 5 минут. 
■ Формула: (buys_volume_5m - sells_volume_5m) / (buys_volume_5m + 

sells_volume_5m) 
5. Требования к системе и интерфейсу 

5.1. База данных: 
● Структура БД должна позволять хранить как текущие, так и исторические срезы данных (минимум за последний час) для корректного расчета динамических 
показателей. 

● Обязательные поля для сущности "Токен": token_address, status, created_at, 
activated_at, last_score_value, low_activity_streak, timestamps смены статусов. 

● Обязательные поля для сущности "Пул": pool_address, token_address, dex_name, 
liquidity_history, tx_count_history. 

5.2. Веб-интерфейс (https://tothemoon.sh1z01d.ru): 
● Главный экран: Интерфейс должен предоставлять возможность просмотра 

списков токенов по каждому статусу (Активный, Начальный, Архивный) с помощью 
вкладок или фильтра. Основным представлением по умолчанию является таблица с 
токенами в статусе Активный. 

● Колонки таблицы: Название токена, итоговый Score (для активных), ключевые 
метрики с индикаторами динамики (например, Объем (5м): $15.2k (+25%)), 
количество активных пулов, время в текущем статусе. 

● Визуализация: В строки таблицы для активных токенов должны быть встроены 
sparkline-графики, отображающие динамику скора за последние несколько часов. 

● Детальный вид: При клике на токен должна открываться отдельная 

страница/модальное окно с подробной информацией: список всех пулов, графики 
метрик, история изменения статусов. 

5.3. Админ-панель: 
Интерфейс для управления ключевыми параметрами системы без необходимости 
внесения изменений в код. Должны быть доступны для редактирования: 

● Активная модель скоринга: Выпадающий список или переключатель для выбора 
текущего алгоритма расчета скора (например, "Модель 1: Гибридный Импульс", 
"Модель 2: ..."). 

● Весовые коэффициенты для формулы скоринга (W_tx, W_vol, и т.д.). 
● Параметры сглаживания EWMA (alpha). 
● минимальный_скор для удержания статуса Активный. 
● Временное окно для понижения статуса из-за низкого скора (в часах, по 

умолчанию 6). 
● min_tx_count — Минимальное количество транзакций для активации и удержания 

статуса "Активный" (по умолчанию 300). 
● LOW_ACTIVITY_STREAK_LIMIT — Количество последовательных проверок (N) для 

понижения статуса из-за низкой активности в пулах (по умолчанию 10). 

	Функциональное задание: Система скоринга токенов "ToTheMoon" 
	1. Общее описание и цели 
	2. Источники данных и ключевые сущности 
	3. Жизненный цикл токена 
	4. Расчет скоринга 
	5. Требования к системе и интерфейсу