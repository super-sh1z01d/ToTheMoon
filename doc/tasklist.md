# Пошаговый план разработки "ToTheMoon"

Этот документ содержит итерационный план разработки. Каждая итерация добавляет новый, тестируемый функционал в приложение. После завершения каждой итерации соответствующий чекбокс отмечается, и таблица прогресса обновляется.

## Отчет о прогрессе

| Итерация | Статус | Ключевой результат |
| :--- | :--- | :--- |
| **0. Настройка проекта** | ✅ `Done` | Создана структура проекта, "Hello World" для бэка и фронта. |
| **1. Ядро бэкенда и БД** | ✅ `Done` | Настроена БД, создан API для получения пустого списка токенов. |
| **2. Сбор данных (WebSocket)** | ✅ `Done` | Бэкенд готов к приему данных (ожидает внешний сервис). |
| **3. Базовое отображение на фронтенде** | ✅ `Done` | Фронтенд отображает список токенов из БД в реальном времени. |
| **4. Логика активации токенов** | ✅ `Done` | Бэкенд готов к активации токенов (ожидает данные). |
| **5. Логика скоринга** | ✅ `Done` | Бэкенд готов к расчету скора (ожидает данные). |
| **6. Админ-панель** | ✅ `Done` | Создан интерфейс для управления параметрами скоринга. |
| **7. Деплой и финализация** | ✅ `Done` | Готов скрипт развертывания и финальная конфигурация. |

---

## План работ

### Итерация 0: Настройка проекта
*Цель: Подготовить скелет приложения и убедиться, что базовые части (бэк и фронт) запускаются.*
- [x] Создать структуру директорий (`backend`, `frontend`, `scripts`), как описано в `vision.md`.
- [x] Инициализировать backend-проект с FastAPI, создать `requirements.txt` с `fastapi` и `uvicorn`.
- [x] Создать `backend/app/main.py` с одним эндпоинтом `/`, возвращающим `{"message": "Hello World"}`.
- [x] Инициализировать frontend-проект с помощью `npm create vite@latest` (React, TypeScript).
- [x] Создать базовый файл `.env.example`.
- [x] **Тест:** Запустить бэкенд (`uvicorn`), запустить фронтенд (`npm run dev`). Убедиться, что оба запускаются без ошибок.

### Итерация 1: Ядро бэкенда и БД
*Цель: Настроить базу данных и создать API для чтения данных.*
- [x] Добавить `sqlalchemy`, `sqlmodel` в `requirements.txt`.
- [x] Определить модели `Token`, `Pool`, `ScoringParameter` в `backend/app/models/` согласно `vision.md`.
- [x] Настроить подключение к SQLite и создать механизм для инициализации таблиц в БД при старте.
- [x] Создать эндпоинт `GET /api/tokens`, который подключается к БД и возвращает пустой список.
- [x] **Тест:** Запустить бэкенд, убедиться, что файл БД (`tothemoon.db`) создался. Отправить запрос на `GET /api/tokens` и получить в ответ `[]`.

### Итерация 2: Сбор данных (WebSocket)
*Цель: Реализовать получение данных о новых токенах и их сохранение.*
- [x] Добавить `websockets` и `httpx` в `requirements.txt`.
- [x] Создать сервис `backend/app/services/ingestion.py` для подключения к WebSocket `pumpportal.fun`.
- [x] Реализовать логику сохранения нового токена в БД со статусом `Initial` при получении сообщения.
- [x] Интегрировать запуск сервиса как фоновую задачу (`asyncio.Task`) при старте FastAPI.
- [x] **Тест:** Запустить бэкенд. Через 1-2 минуты отправить запрос на `GET /api/tokens` и увидеть список токенов со статусом `Initial`.

### Итерация 3: Базовое отображение на фронтенде
*Цель: Вывести данные из бэкенда на веб-страницу.*
- [x] Установить `mantine` и `axios` в `frontend`.
- [x] Создать сервис `frontend/src/services/api.ts` для выполнения запросов к бэкенду.
- [x] Создать компонент `TokenTable.tsx`, который запрашивает данные с `GET /api/tokens`.
- [x] Вывести данные в таблицу `Mantine`, отображая `token_address` и `status`.
- [x] Добавить автоматическое обновление данных каждые 10 секунд.
- [x] **Тест:** Запустить бэкенд и фронтенд. Открыть страницу в браузере и увидеть таблицу с токенами, которая пополняется в реальном времени.

### Итерация 4: Логика активации токенов
*Цель: Реализовать бизнес-логику смены статуса токенов.*
- [x] Создать сервис `backend/app/services/activation.py`.
- [x] Реализовать в нем фоновую задачу, которая:
    - Выбирает токены со статусом `Initial`.
    - Запрашивает их данные через Birdeye API.
    - Обновляет их статус на `Active` или `Archived` согласно правилам из `functional_task.md`.
- [x] **Тест:** Наблюдать за таблицей на фронтенде. Статусы токенов должны через некоторое время меняться с `Initial` на `Active` или `Archived`.

### Итерация 5: Логика скоринга
*Цель: Реализовать расчет скора для активных токенов.*
- [x] Создать модульный сервис `backend/app/services/scoring.py`.
- [x] Реализовать формулы расчета `Tx_Accel`, `Vol_Momentum` и других компонентов скора.
- [x] Создать фоновую задачу для периодического расчета и сохранения `last_score_value` для всех `Active` токенов.
- [x] Добавить поле `last_score_value` в ответ эндпоинта `GET /api/tokens`.
- [x] Отобразить колонку "Score" в таблице на фронтенде.
- [x] **Тест:** Наблюдать за таблицей на фронтенде. У активных токенов должно появиться и обновляться значение в колонке "Score".

### Итерация 6: Админ-панель
*Цель: Дать возможность управлять параметрами системы через UI.*
- [x] Создать API эндпоинты `GET /api/parameters` и `POST /api/parameters` для управления `ScoringParameter`.
- [x] В логике скоринга заменить хардкод на значения из БД.
- [x] Создать на фронтенде новую страницу (`/admin`).
- [x] На странице `/admin` создать форму для редактирования весов и порогов.
- [x] **Тест:** Открыть админ-панель, изменить один из весовых коэффициентов. Вернуться на главную страницу и убедиться, что значения скора у токенов изменились.

### Итерация 7: Деплой и финализация
*Цель: Подготовить проект к развертыванию на сервере.*
- [x] Наполнить скрипт `scripts/deploy.sh` реальными командами (установка зависимостей, сборка фронтенда, перезапуск сервиса).
- [x] Добавить эндпоинт `GET /health` на бэкенд, который возвращает `{"status": "ok"}`.
- [x] Настроить ротируемое логгирование в файл для бэкенда.
- [x] Написать пример конфигурации `nginx` для раздачи статики и проксирования API.
- [x] **Тест:** Запустить `scripts/deploy.sh` (локально, с адаптацией) и проверить, что приложение полностью поднимается и работает.
